<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="A look a Harry Browne's Permanent Portfolio and performance over nearly four decades.">
<title>Does Harry Browne&#39;s permanent portfolio withstand the test of time?</title>

<link rel='canonical' href='https://www.jaredszajkowski.com/2024/11/04/harry-browne-permanent-portfolio/'>

<link rel="stylesheet" href="/scss/style.min.f0812745d896b649355b3be3c3a11af9d60e84b875a0bb7cdf045df4280431b6.css"><meta property='og:title' content="Does Harry Browne's permanent portfolio withstand the test of time?">
<meta property='og:description' content="A look a Harry Browne's Permanent Portfolio and performance over nearly four decades.">
<meta property='og:url' content='https://www.jaredszajkowski.com/2024/11/04/harry-browne-permanent-portfolio/'>
<meta property='og:site_name' content='Jared Szajkowski'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Python' /><meta property='article:tag' content='Bloomberg' /><meta property='article:tag' content='pandas' /><meta property='article:published_time' content='2024-11-04T00:00:01&#43;00:00'/><meta property='article:modified_time' content='2025-05-06T00:00:01&#43;00:00'/><meta property='og:image' content='https://www.jaredszajkowski.com/2024/11/04/harry-browne-permanent-portfolio/cover.jpg' />
<meta name="twitter:title" content="Does Harry Browne's permanent portfolio withstand the test of time?">
<meta name="twitter:description" content="A look a Harry Browne's Permanent Portfolio and performance over nearly four decades."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://www.jaredszajkowski.com/2024/11/04/harry-browne-permanent-portfolio/cover.jpg' />
    <link rel="shortcut icon" href="/profile_pic.jpg" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/profile_pic_hu_35859dcdcf246484.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Jared Szajkowski</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='mailto:jared.szajkowski@gmail.com'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z" /><path d="M3 7l9 6l9 -6" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/jaredszajkowski'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.linkedin.com/in/jaredszajkowski/'
                        target="_blank"
                        title="LinkedIn"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" /><path d="M8 11l0 5" /><path d="M8 8l0 .01" /><path d="M12 16l0 -5" /><path d="M16 16v-3a2 2 0 0 0 -4 0" /></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about-me/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About Me</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#post-updates">Post Updates</a></li>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#brownes-portfolio-requirements">Browne&rsquo;s Portfolio Requirements</a></li>
    <li><a href="#the-permanent-portfolio">The Permanent Portfolio</a></li>
    <li><a href="#data">Data</a></li>
    <li><a href="#python-functions">Python Functions</a>
      <ol>
        <li><a href="#typical-functions">Typical Functions</a></li>
        <li><a href="#project-specific-functions">Project Specific Functions</a>
          <ol>
            <li><a href="#data-cleaning-function-for-bloomberg-data">Data Cleaning Function For Bloomberg Data</a></li>
            <li><a href="#portfolio-trading-strategy">Portfolio Trading Strategy</a></li>
            <li><a href="#summary-stats">Summary Stats</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#data-overview">Data Overview</a>
      <ol>
        <li><a href="#set-decimal-places">Set Decimal Places</a></li>
        <li><a href="#load-data">Load Data</a></li>
        <li><a href="#combine-data">Combine Data</a></li>
        <li><a href="#check-for-missing-values">Check For Missing Values</a></li>
        <li><a href="#dataframe-info">DataFrame Info</a></li>
      </ol>
    </li>
    <li><a href="#execute-strategy">Execute Strategy</a></li>
    <li><a href="#strategy-statistics">Strategy Statistics</a></li>
    <li><a href="#annual-returns">Annual Returns</a></li>
    <li><a href="#generate-plots">Generate Plots</a>
      <ol>
        <li><a href="#plot-cumulative-return">Plot Cumulative Return</a></li>
        <li><a href="#plot-portfolio-values">Plot Portfolio Values</a></li>
        <li><a href="#plot-portfolio-drawdown">Plot Portfolio Drawdown</a></li>
        <li><a href="#plot-portfolio-asset-weights">Plot Portfolio Asset Weights</a></li>
      </ol>
    </li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#references">References</a></li>
    <li><a href="#code">Code</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/2024/11/04/harry-browne-permanent-portfolio/">
                <img src="/2024/11/04/harry-browne-permanent-portfolio/cover.jpg"
                        
                        width="1792" 
                        height="1024" 
                        loading="lazy"
                        alt="Featured image of post Does Harry Browne&#39;s permanent portfolio withstand the test of time?" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/financial-data/" >
                Financial Data
            </a>
        
            <a href="/categories/investing/" >
                Investing
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/2024/11/04/harry-browne-permanent-portfolio/">Does Harry Browne&#39;s permanent portfolio withstand the test of time?</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            A look a Harry Browne&#39;s Permanent Portfolio and performance over nearly four decades.
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">November 4, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    31 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="post-updates">Post Updates
</h2><p>Update 12/5/2024: Updated code for summary stats function, various code comments, and corrected grammatical errors.</br>
Update 2/19/2025: Various code updates, commented and documented functions.</br>
Update 5/2/2025: Updated functions and code.</p>
<h2 id="introduction">Introduction
</h2><p>Harry Browne was an influencial politician, financial advisor, and author who lived from 1933 to 2006 and published 12 books. Wikipedia has <a class="link" href="https://en.wikipedia.org/wiki/Harry_Browne"  target="_blank" rel="noopener"
    >an in-depth biography</a> on him.</p>
<p>Within the world of finance and investing, one of his best known works is <em>Fail-Safe Investing: Lifelong Financial Security in 30 Minutes</em>. In it, he introduces the idea of the &ldquo;Permanent Portfolio&rdquo;, an investment strategy that uses only four assets and is very simple to implement.</p>
<p>In this post, we will investigate Browne&rsquo;s suggested portfolio, including performance across various market cycles and economic regimes.</p>
<h2 id="brownes-portfolio-requirements">Browne&rsquo;s Portfolio Requirements
</h2><p>In <em>Fail-Safe Investing</em>, under rule #11, Browne lays out the requirements for a &ldquo;bulletproof portfolio&rdquo; that will &ldquo;assure that your wealth will survive any event - including events that would be devastating to any one investment. In other words, this portfolio should protect you <em>no matter what the future brings.</em>&rdquo;</p>
<p>His requirements for the portfolio consist of the followng:</p>
<ol>
<li>Safety: Protection again any economic future, including &ldquo;inflation, recession, or even depression&rdquo;</li>
<li>Stability: Performance should be consistent so that you will not need to make any changes and will not experience significant drawdowns</li>
<li>Simplicity: Easy to implement and take very little time to maintain</li>
</ol>
<p>He then describes the four &ldquo;broad movements&rdquo; of the economy:</p>
<ol>
<li>Prosperity: The economy is growing, business is doing well, interest rates are usually low</li>
<li>Inflation: The cost of goods and services is rising</li>
<li>Tight money or recession: The money supply is shrinking, economic activity is slowing</li>
<li>Deflation: Prices are declining and the value of money is increasing</li>
</ol>
<h2 id="the-permanent-portfolio">The Permanent Portfolio
</h2><p>Browne then matches an asset class to each of the economic conditions above:</p>
<ol>
<li>Prosperity -&gt; Stocks (due to prosperity) and long term bonds (when interest rates fall)</li>
<li>Inflation -&gt; Gold</li>
<li>Deflation -&gt; Long term bonds (when interest rates fall)</li>
<li>Tight money -&gt; Cash</li>
</ol>
<p>He completes the Permanent Portfolio by stipulating the following:</p>
<ul>
<li>Start with a base allocation of 25% to each of the asset classes (stocks, bonds, gold, cash)</li>
<li>Rebalance back to the base allocation annually, or when &ldquo;any of the four investments has become worth less than 15%, or more than 35%, of the portfolio&rsquo;s overall value&rdquo;</br><strong>Note:</strong> Browne does not specify when the portfolio should be rebalanced; therefore, we will make an assumption of a January 1st rebalance.</li>
</ul>
<h2 id="data">Data
</h2><p>For this exercise, we will use the following asset classes:</p>
<ol>
<li>Stocks: S&amp;P 500 (SPXT_S&amp;P 500 Total Return Index)</li>
<li>Bonds: 10 Year US Treasuries (SPBDU10T_S&amp;P US Treasury Bond 7-10 Year Total Return Index)</li>
<li>Gold: Gold Spot Price (XAU_Gold USD Spot)</li>
<li>Cash: USD</li>
</ol>
<p>With the exception of cash, all data is sourced from Bloomberg.</p>
<p>We could use ETFs, but the available price history for the ETFs is much shorter than the indices above. If we wanted to use ETFs, the following would work:</p>
<ol>
<li>Stocks: IVV - iShares Core S&amp;P 500 ETF</li>
<li>Bonds: IEF - iShares 7-10 Year Treasury Bond ETF</li>
<li>Gold: IAU - iShares Gold Trust</li>
<li>Cash: USD</li>
</ol>
<h2 id="python-functions">Python Functions
</h2><h3 id="typical-functions">Typical Functions
</h3><p>First, the typical set of functions I use:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">export_track_md_deps</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">dep_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">md_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Export Markdown content to a file and track it as a dependency.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function writes the provided content to the specified Markdown file and 
</span></span></span><span class="line"><span class="cl"><span class="s2">    appends the filename to the given dependency file (typically `index_dep.txt`).
</span></span></span><span class="line"><span class="cl"><span class="s2">    This is useful in workflows where Markdown fragments are later assembled 
</span></span></span><span class="line"><span class="cl"><span class="s2">    into a larger document (e.g., a Hugo `index.md`).
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    dep_file : Path
</span></span></span><span class="line"><span class="cl"><span class="s2">        Path to the dependency file that tracks Markdown fragment filenames.
</span></span></span><span class="line"><span class="cl"><span class="s2">    md_filename : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The name of the Markdown file to export.
</span></span></span><span class="line"><span class="cl"><span class="s2">    content : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The Markdown-formatted content to write to the file.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    None
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; export_track_md_deps(Path(&#34;index_dep.txt&#34;), &#34;01_intro.md&#34;, &#34;# Introduction</span><span class="se">\n</span><span class="s2">...&#34;)
</span></span></span><span class="line"><span class="cl"><span class="s2">    ✅ Exported and tracked: 01_intro.md
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">Path</span><span class="p">(</span><span class="n">md_filename</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">dep_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">md_filename</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;✅ Exported and tracked: </span><span class="si">{</span><span class="n">md_filename</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></br>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">df_info</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Display summary information about a pandas DataFrame.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function prints:
</span></span></span><span class="line"><span class="cl"><span class="s2">    - The DataFrame&#39;s column names, shape, and data types via `df.info()`
</span></span></span><span class="line"><span class="cl"><span class="s2">    - The first 5 rows using `df.head()`
</span></span></span><span class="line"><span class="cl"><span class="s2">    - The last 5 rows using `df.tail()`
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    It uses `display()` for better output formatting in environments like Jupyter notebooks.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        The DataFrame to inspect.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    None
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; df_info(my_dataframe)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The columns, shape, and data types are:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The first 5 rows are:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The last 5 rows are:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div></br>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">io</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">df_info_markdown</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Generate a Markdown-formatted summary of a pandas DataFrame.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function captures and formats the output of `df.info()`, `df.head()`, 
</span></span></span><span class="line"><span class="cl"><span class="s2">    and `df.tail()` in Markdown for easy inclusion in reports, documentation, 
</span></span></span><span class="line"><span class="cl"><span class="s2">    or web-based rendering (e.g., Hugo or Jupyter export workflows).
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        The DataFrame to summarize.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    str
</span></span></span><span class="line"><span class="cl"><span class="s2">        A string containing the DataFrame&#39;s info, head, and tail 
</span></span></span><span class="line"><span class="cl"><span class="s2">        formatted in Markdown.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; print(df_info_markdown(df))
</span></span></span><span class="line"><span class="cl"><span class="s2">    ```text
</span></span></span><span class="line"><span class="cl"><span class="s2">    The columns, shape, and data types are:
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;output from df.info()&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    ```
</span></span></span><span class="line"><span class="cl"><span class="s2">    The first 5 rows are:
</span></span></span><span class="line"><span class="cl"><span class="s2">    |   | col1 | col2 |
</span></span></span><span class="line"><span class="cl"><span class="s2">    |---|------|------|
</span></span></span><span class="line"><span class="cl"><span class="s2">    | 0 | ...  | ...  |
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    The last 5 rows are:
</span></span></span><span class="line"><span class="cl"><span class="s2">    ...
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Capture df.info() output</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">buf</span><span class="o">=</span><span class="n">buffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">info_str</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Convert head and tail to Markdown</span>
</span></span><span class="line"><span class="cl">    <span class="n">head_str</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">floatfmt</span><span class="o">=</span><span class="s2">&#34;.2f&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">tail_str</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">floatfmt</span><span class="o">=</span><span class="s2">&#34;.2f&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">markdown</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;```text&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;The columns, shape, and data types are:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">info_str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;```&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">The first 5 rows are:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">head_str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">The last 5 rows are:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">tail_str</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></br>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">pandas_set_decimal_places</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Set the number of decimal places displayed for floating-point numbers in pandas.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    decimal_places : int
</span></span></span><span class="line"><span class="cl"><span class="s2">        The number of decimal places to display for float values in pandas DataFrames and Series.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    None
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; dp(3)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; pd.DataFrame([1.23456789])
</span></span></span><span class="line"><span class="cl"><span class="s2">           0
</span></span></span><span class="line"><span class="cl"><span class="s2">    0   1.235
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.float_format&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;%.</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s1">f&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></br>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">timeframe</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Load data from a CSV, Excel, or Pickle file into a pandas DataFrame.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function attempts to read a file first as a CSV, then as an Excel file 
</span></span></span><span class="line"><span class="cl"><span class="s2">    (specifically looking for a sheet named &#39;data&#39; and using the &#39;calamine&#39; engine).
</span></span></span><span class="line"><span class="cl"><span class="s2">    If both attempts fail, a ValueError is raised.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    base_directory : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Root path to read data file.
</span></span></span><span class="line"><span class="cl"><span class="s2">    ticker : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Ticker symbol to read.
</span></span></span><span class="line"><span class="cl"><span class="s2">    source : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Name of the data source (e.g., &#39;Yahoo&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    asset_class : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Asset class name (e.g., &#39;Equities&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    timeframe : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Timeframe for the data (e.g., &#39;Daily&#39;, &#39;Month_End&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        The loaded data.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Raises:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    ValueError
</span></span></span><span class="line"><span class="cl"><span class="s2">        If the file could not be loaded as either CSV or Excel.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; df = load_data(DATA_DIR, &#34;^VIX&#34;, &#34;Yahoo_Finance&#34;, &#34;Indices&#34;)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Build file paths using pathlib</span>
</span></span><span class="line"><span class="cl">    <span class="n">csv_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">source</span> <span class="o">/</span> <span class="n">asset_class</span> <span class="o">/</span> <span class="n">timeframe</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.csv&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">csv_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">source</span> <span class="o">/</span> <span class="n">asset_class</span> <span class="o">/</span> <span class="n">timeframe</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.zip&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">xlsx_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">source</span> <span class="o">/</span> <span class="n">asset_class</span> <span class="o">/</span> <span class="n">timeframe</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.xlsx&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">source</span> <span class="o">/</span> <span class="n">asset_class</span> <span class="o">/</span> <span class="n">timeframe</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.pkl&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Try CSV</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Try Zip</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Try Excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xlsx_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Try Pickle</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;❌ Unable to load file: </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">. Ensure it&#39;s a valid CSV, Excel, Zip, or Pickle file with a &#39;data&#39; sheet (if required).&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="project-specific-functions">Project Specific Functions
</h3><h4 id="data-cleaning-function-for-bloomberg-data">Data Cleaning Function For Bloomberg Data
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">bb_clean_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_ticker_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function takes an excel export from Bloomberg and removes all excess data leaving date and close columns
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    base_directory : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Root path to store downloaded data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    fund : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The fund to clean the data from.
</span></span></span><span class="line"><span class="cl"><span class="s2">    source : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Name of the data source (e.g., &#39;Bloomberg&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    asset_class : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Asset class name (e.g., &#39;Equities&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    excel_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Excel format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    pickle_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Pickle format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    output_confirmation : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print confirmation message.
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing cleaned data prices.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set location from where to read existing excel file</span>
</span></span><span class="line"><span class="cl">    <span class="n">location</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_class</span><span class="si">}</span><span class="s2">/Daily/</span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2">.xlsx&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Read data from excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span><span class="s2">&#34;Worksheet&#34;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&#34;calamine&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;File not found...please download the data for </span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set the column headings from row 5 (which is physically row 6)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set the column heading for the index to be &#34;None&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Drop the first 6 rows, 0 - 5</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set the date column as the index</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Drop the volume column</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PX_VOLUME&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># Rename column</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PX_LAST&#39;</span><span class="p">:</span><span class="s1">&#39;Close&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Sort by date</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create directory</span>
</span></span><span class="line"><span class="cl">    <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_class</span><span class="si">}</span><span class="s2">/Daily&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">excel_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2">_Clean.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to pickle</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">pickle_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2">_Clean.pkl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output confirmation</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">output_confirmation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;The first and last date of data for </span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2"> is: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Bloomberg data cleaning complete for </span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;--------------------&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="portfolio-trading-strategy">Portfolio Trading Strategy
</h4><p>This is the function that executes the trading strategy for the permanent portfolio based on the above parameters.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">strategy_harry_brown_perm_port</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">starting_cash</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">cash_contrib</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">close_prices_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_day</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_per_high</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_per_low</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Execute the rebalance strategy based on specified criteria.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    fund_list (str):
</span></span></span><span class="line"><span class="cl"><span class="s2">        List of funds for data to be combined from. Funds are strings in the form &#34;BTC-USD&#34;.
</span></span></span><span class="line"><span class="cl"><span class="s2">    starting_cash (int):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Starting investment balance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    cash_contrib (int):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Cash contribution to be made daily.
</span></span></span><span class="line"><span class="cl"><span class="s2">    close_prices_df (pd.DataFrame):
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing date and close prices for all funds to be included.
</span></span></span><span class="line"><span class="cl"><span class="s2">    rebal_month (int):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Month for annual rebalance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    rebal_day (int):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Day for annual rebalance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    rebal_per_high (float):
</span></span></span><span class="line"><span class="cl"><span class="s2">        High percentage for rebalance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    rebal_per_low (float):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Low percentage for rebalance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    excel_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Excel format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    pickle_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Pickle format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    output_confirmation : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print confirmation message.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df (pd.DataFrame):
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing strategy data for all funds to be included. Also dumps the df to excel for reference later.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">num_funds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fund_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">close_prices_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Date to be used for annual rebalance</span>
</span></span><span class="line"><span class="cl">    <span class="n">target_month</span> <span class="o">=</span> <span class="n">rebal_month</span>
</span></span><span class="line"><span class="cl">    <span class="n">target_day</span> <span class="o">=</span> <span class="n">rebal_day</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a dataframe with dates from the specific month</span>
</span></span><span class="line"><span class="cl">    <span class="n">rebal_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="n">target_month</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Specify the date or the next closest</span>
</span></span><span class="line"><span class="cl">    <span class="n">rebal_date</span> <span class="o">=</span> <span class="n">rebal_date</span><span class="p">[</span><span class="n">rebal_date</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="o">&gt;=</span> <span class="n">target_day</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Group by year and take the first entry for each year</span>
</span></span><span class="line"><span class="cl">    <span class="n">rebal_dates_by_year</span> <span class="o">=</span> <span class="n">rebal_date</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">rebal_date</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    Column order for the dataframe:
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_BA_Shares&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_BA_$_Invested&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_BA_Port_%&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[&#39;Total_BA_$_Invested&#39;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[&#39;Contribution&#39;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[&#39;Rebalance&#39;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_AA_Shares&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_AA_$_Invested&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_AA_Port_%&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[&#39;Total_AA_$_Invested&#39;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculate the columns and initial values for before action (BA) shares, $ invested, and port %</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Shares&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_cash</span> <span class="o">/</span> <span class="n">num_funds</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_$_Invested&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Shares&#34;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Port_%&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set column values initially</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total_BA_$_Invested&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_cash</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Contribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cash_contrib</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Rebalance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;No&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set columns and values initially for after action (AA) shares, $ invested, and port %</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Shares&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_cash</span> <span class="o">/</span> <span class="n">num_funds</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Shares&#34;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Port_%&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># Set column value for after action (AA) total $ invested</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total_AA_$_Invested&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_cash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Iterate through the dataframe and execute the strategy</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Ensure there&#39;s a previous row to reference by checking the index value</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Initialize variable</span>
</span></span><span class="line"><span class="cl">            <span class="n">Total_BA_Invested</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Calculate before action (BA) shares and $ invested values</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Shares&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Shares&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_$_Invested&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Shares&#34;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Sum the asset values to find the total</span>
</span></span><span class="line"><span class="cl">                <span class="n">Total_BA_Invested</span> <span class="o">=</span> <span class="n">Total_BA_Invested</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_$_Invested&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Calculate before action (BA) port % values</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Port_%&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_$_Invested&#34;</span><span class="p">]</span> <span class="o">/</span> <span class="n">Total_BA_Invested</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Set column for before action (BA) total $ invested</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Total_BA_$_Invested&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Total_BA_Invested</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Initialize variables</span>
</span></span><span class="line"><span class="cl">            <span class="n">rebalance</span> <span class="o">=</span> <span class="s2">&#34;No&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Check for a specific date annually</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Simple if statement to check if date_to_check is in jan_28_or_after_each_year</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">rebal_dates_by_year</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rebalance</span> <span class="o">=</span> <span class="s2">&#34;Yes&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Check to see if any asset has portfolio percentage of greater than 35% or less than 15% and if so set variable</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Port_%&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rebal_per_high</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Port_%&#34;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rebal_per_low</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">rebalance</span> <span class="o">=</span> <span class="s2">&#34;Yes&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># If rebalance is required, rebalance back to 25% for each asset, else just divide contribution evenly across assets</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">rebalance</span> <span class="o">==</span> <span class="s2">&#34;Yes&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Rebalance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rebalance</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Total_BA_Invested</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Contribution&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.25</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Rebalance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rebalance</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_$_Invested&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Contribution&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.25</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Initialize variable</span>
</span></span><span class="line"><span class="cl">            <span class="n">Total_AA_Invested</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Set column values for after action (AA) shares and port %</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Shares&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Sum the asset values to find the total</span>
</span></span><span class="line"><span class="cl">                <span class="n">Total_AA_Invested</span> <span class="o">=</span> <span class="n">Total_AA_Invested</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Calculate after action (AA) port % values</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Port_%&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span> <span class="o">/</span> <span class="n">Total_AA_Invested</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Set column for after action (AA) total $ invested</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Total_AA_$_Invested&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Total_AA_Invested</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># If this is the first row</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total_AA_$_Invested&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Cumulative_Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plan_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fund_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">excel_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">_Strategy.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to pickle</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">pickle_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">_Strategy.pkl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output confirmation</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">output_confirmation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Strategy complete for </span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="summary-stats">Summary Stats
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">summary_stats</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Calculate summary statistics for the given fund list and return data.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    fund_list (str):
</span></span></span><span class="line"><span class="cl"><span class="s2">        List of funds for data to be combined from. Funds are strings in the form &#34;BTC-USD&#34;.
</span></span></span><span class="line"><span class="cl"><span class="s2">    df (pd.DataFrame):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Dataframe with return data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    period (str):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Period for which to calculate statistics. Options are &#34;Monthly&#34;, &#34;Weekly&#34;, &#34;Daily&#34;, &#34;Hourly&#34;.
</span></span></span><span class="line"><span class="cl"><span class="s2">    excel_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Excel format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    pickle_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Pickle format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    output_confirmation : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print confirmation message.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df_stats (pd.DataFrame):
</span></span></span><span class="line"><span class="cl"><span class="s2">        pd.DataFrame: DataFrame containing various portfolio statistics.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="s2">&#34;Monthly&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">timeframe</span> <span class="o">=</span> <span class="mi">12</span> <span class="c1"># months</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">period</span> <span class="o">==</span> <span class="s2">&#34;Weekly&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">timeframe</span> <span class="o">=</span> <span class="mi">52</span> <span class="c1"># weeks</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">period</span> <span class="o">==</span> <span class="s2">&#34;Daily&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">timeframe</span> <span class="o">=</span> <span class="mi">252</span> <span class="c1"># days</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># timeframe = 365 # days</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">period</span> <span class="o">==</span> <span class="s2">&#34;Hourly&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">timeframe</span> <span class="o">=</span> <span class="mi">252</span> <span class="o">*</span> <span class="mf">6.5</span> <span class="c1"># hours</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     timeframe = 8760 # hours</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># else:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Error, check inputs&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeframe</span><span class="p">)</span> <span class="c1"># annualized</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># df_stats = pd.DataFrame((1 + df.mean(axis=0)) ** timeframe - 1) # annualized, this is this true annualized return but we will simply use the mean</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Annualized Mean&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Annualized Volatility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">timeframe</span><span class="p">)</span> <span class="c1"># annualized</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Annualized Sharpe Ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Annualized Mean&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Annualized Volatility&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df_cagr</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">cagr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_cagr</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_cagr</span><span class="p">)</span> <span class="o">/</span> <span class="n">timeframe</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;CAGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cagr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="n">period</span> <span class="o">+</span> <span class="s1">&#39; Max Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="n">period</span> <span class="o">+</span> <span class="s1">&#39; Max Return (Date)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="n">period</span> <span class="o">+</span> <span class="s1">&#39; Min Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="n">period</span> <span class="o">+</span> <span class="s1">&#39; Min Return (Date)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">wealth_index</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">previous_peaks</span> <span class="o">=</span> <span class="n">wealth_index</span><span class="o">.</span><span class="n">cummax</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">drawdowns</span> <span class="o">=</span> <span class="p">(</span><span class="n">wealth_index</span> <span class="o">-</span> <span class="n">previous_peaks</span><span class="p">)</span><span class="o">/</span><span class="n">previous_peaks</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Max Drawdown&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">drawdowns</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">previous_peaks</span><span class="p">[</span><span class="n">col</span><span class="p">][:</span><span class="n">drawdowns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">previous_peaks</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">drawdowns</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">recovery_date</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">wealth_index</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">prev_max</span> <span class="o">=</span> <span class="n">previous_peaks</span><span class="p">[</span><span class="n">col</span><span class="p">][:</span><span class="n">drawdowns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">recovery_wealth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">wealth_index</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">drawdowns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">():]])</span><span class="o">.</span><span class="n">T</span>
</span></span><span class="line"><span class="cl">        <span class="n">recovery_date</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recovery_wealth</span><span class="p">[</span><span class="n">recovery_wealth</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">prev_max</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Recovery Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recovery_date</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plan_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fund_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">excel_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_stats</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">_Summary_Stats.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to pickle</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">pickle_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_stats</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">_Summary_Stats.pkl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output confirmation</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">output_confirmation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Summary stats complete for </span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df_stats</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="data-overview">Data Overview
</h2><h3 id="set-decimal-places">Set Decimal Places
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pandas_set_decimal_places</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="load-data">Load Data
</h3><p>As previously mentioned, the data for this exercise comes primarily from Bloomberg. We&rsquo;ll start with loading the data first for bonds:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Bonds dataframe</span>
</span></span><span class="line"><span class="cl"><span class="n">bb_clean_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_ticker_name</span><span class="o">=</span><span class="s2">&#34;SPBDU10T_S&amp;P US Treasury Bond 7-10 Year Total Return Index&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="o">=</span><span class="s2">&#34;Bloomberg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="o">=</span><span class="s2">&#34;Indices&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">bonds_data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ticker</span><span class="o">=</span><span class="s2">&#34;SPBDU10T_S&amp;P US Treasury Bond 7-10 Year Total Return Index_Clean&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="o">=</span><span class="s2">&#34;Bloomberg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="o">=</span><span class="s2">&#34;Indices&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">timeframe</span><span class="o">=</span><span class="s2">&#34;Daily&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">bonds_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">bonds_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">bonds_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bonds_data</span> <span class="o">=</span> <span class="n">bonds_data</span><span class="p">[(</span><span class="n">bonds_data</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s1">&#39;1990-01-01&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">bonds_data</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="s1">&#39;2023-12-31&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">bonds_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Close&#39;</span><span class="p">:</span><span class="s1">&#39;Bonds_Close&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bonds_data</span><span class="p">[</span><span class="s1">&#39;Bonds_Daily_Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonds_data</span><span class="p">[</span><span class="s1">&#39;Bonds_Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">bonds_data</span><span class="p">[</span><span class="s1">&#39;Bonds_Total_Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">bonds_data</span><span class="p">[</span><span class="s1">&#39;Bonds_Daily_Return&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">bonds_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The following is the output:</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">Date</th>
          <th style="text-align: right">Bonds_Close</th>
          <th style="text-align: right">Bonds_Daily_Return</th>
          <th style="text-align: right">Bonds_Total_Return</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">1990-01-02 00:00:00</td>
          <td style="text-align: right">99.972</td>
          <td style="text-align: right">nan</td>
          <td style="text-align: right">nan</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-03 00:00:00</td>
          <td style="text-align: right">99.733</td>
          <td style="text-align: right">-0.002</td>
          <td style="text-align: right">0.998</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-04 00:00:00</td>
          <td style="text-align: right">99.813</td>
          <td style="text-align: right">0.001</td>
          <td style="text-align: right">0.998</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-05 00:00:00</td>
          <td style="text-align: right">99.769</td>
          <td style="text-align: right">-0.000</td>
          <td style="text-align: right">0.998</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-08 00:00:00</td>
          <td style="text-align: right">99.681</td>
          <td style="text-align: right">-0.001</td>
          <td style="text-align: right">0.997</td>
      </tr>
  </tbody>
</table></div>
<p>Then for stocks:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Stocks dataframe</span>
</span></span><span class="line"><span class="cl"><span class="n">bb_clean_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_ticker_name</span><span class="o">=</span><span class="s2">&#34;SPXT_S&amp;P 500 Total Return Index&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="o">=</span><span class="s2">&#34;Bloomberg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="o">=</span><span class="s2">&#34;Indices&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">stocks_data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ticker</span><span class="o">=</span><span class="s2">&#34;SPXT_S&amp;P 500 Total Return Index_Clean&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="o">=</span><span class="s2">&#34;Bloomberg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="o">=</span><span class="s2">&#34;Indices&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">timeframe</span><span class="o">=</span><span class="s2">&#34;Daily&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">stocks_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">stocks_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks_data</span> <span class="o">=</span> <span class="n">stocks_data</span><span class="p">[(</span><span class="n">stocks_data</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s1">&#39;1990-01-01&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stocks_data</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="s1">&#39;2023-12-31&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Close&#39;</span><span class="p">:</span><span class="s1">&#39;Stocks_Close&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks_data</span><span class="p">[</span><span class="s1">&#39;Stocks_Daily_Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stocks_data</span><span class="p">[</span><span class="s1">&#39;Stocks_Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">stocks_data</span><span class="p">[</span><span class="s1">&#39;Stocks_Total_Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">stocks_data</span><span class="p">[</span><span class="s1">&#39;Stocks_Daily_Return&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">stocks_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The following is the output:</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">Date</th>
          <th style="text-align: right">Stocks_Close</th>
          <th style="text-align: right">Stocks_Daily_Return</th>
          <th style="text-align: right">Stocks_Total_Return</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">1990-01-01 00:00:00</td>
          <td style="text-align: right">nan</td>
          <td style="text-align: right">nan</td>
          <td style="text-align: right">nan</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-02 00:00:00</td>
          <td style="text-align: right">386.160</td>
          <td style="text-align: right">nan</td>
          <td style="text-align: right">nan</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-03 00:00:00</td>
          <td style="text-align: right">385.170</td>
          <td style="text-align: right">-0.003</td>
          <td style="text-align: right">0.997</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-04 00:00:00</td>
          <td style="text-align: right">382.020</td>
          <td style="text-align: right">-0.008</td>
          <td style="text-align: right">0.989</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-05 00:00:00</td>
          <td style="text-align: right">378.300</td>
          <td style="text-align: right">-0.010</td>
          <td style="text-align: right">0.980</td>
      </tr>
  </tbody>
</table></div>
<p>And finally, gold:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Gold dataframe</span>
</span></span><span class="line"><span class="cl"><span class="n">bb_clean_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_ticker_name</span><span class="o">=</span><span class="s2">&#34;XAU_Gold USD Spot&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="o">=</span><span class="s2">&#34;Bloomberg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="o">=</span><span class="s2">&#34;Commodities&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">gold_data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ticker</span><span class="o">=</span><span class="s2">&#34;XAU_Gold USD Spot_Clean&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="o">=</span><span class="s2">&#34;Bloomberg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="o">=</span><span class="s2">&#34;Commodities&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">timeframe</span><span class="o">=</span><span class="s2">&#34;Daily&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">gold_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">gold_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">gold_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gold_data</span> <span class="o">=</span> <span class="n">gold_data</span><span class="p">[(</span><span class="n">gold_data</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s1">&#39;1990-01-01&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gold_data</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="s1">&#39;2023-12-31&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">gold_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Close&#39;</span><span class="p">:</span><span class="s1">&#39;Gold_Close&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gold_data</span><span class="p">[</span><span class="s1">&#39;Gold_Daily_Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gold_data</span><span class="p">[</span><span class="s1">&#39;Gold_Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">gold_data</span><span class="p">[</span><span class="s1">&#39;Gold_Total_Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">gold_data</span><span class="p">[</span><span class="s1">&#39;Gold_Daily_Return&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">gold_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The following is the output:</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">Date</th>
          <th style="text-align: right">Gold_Close</th>
          <th style="text-align: right">Gold_Daily_Return</th>
          <th style="text-align: right">Gold_Total_Return</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">1990-01-02 00:00:00</td>
          <td style="text-align: right">399.000</td>
          <td style="text-align: right">nan</td>
          <td style="text-align: right">nan</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-03 00:00:00</td>
          <td style="text-align: right">395.000</td>
          <td style="text-align: right">-0.010</td>
          <td style="text-align: right">0.990</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-04 00:00:00</td>
          <td style="text-align: right">396.500</td>
          <td style="text-align: right">0.004</td>
          <td style="text-align: right">0.994</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-05 00:00:00</td>
          <td style="text-align: right">405.000</td>
          <td style="text-align: right">0.021</td>
          <td style="text-align: right">1.015</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-08 00:00:00</td>
          <td style="text-align: right">404.600</td>
          <td style="text-align: right">-0.001</td>
          <td style="text-align: right">1.014</td>
      </tr>
  </tbody>
</table></div>
<h3 id="combine-data">Combine Data
</h3><p>We&rsquo;ll now combine the dataframes for the timeseries data from each of the asset classes, as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Merge the stock data and bond data into a single DataFrame using their indices (dates)</span>
</span></span><span class="line"><span class="cl"><span class="n">perm_port</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">stocks_data</span><span class="p">[</span><span class="s1">&#39;Stocks_Close&#39;</span><span class="p">],</span> <span class="n">bonds_data</span><span class="p">[</span><span class="s1">&#39;Bonds_Close&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Add gold data to the portfolio DataFrame by merging it with the existing data on indices (dates)</span>
</span></span><span class="line"><span class="cl"><span class="n">perm_port</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">perm_port</span><span class="p">,</span> <span class="n">gold_data</span><span class="p">[</span><span class="s1">&#39;Gold_Close&#39;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Add a column for cash with a constant value of 1 (assumes the value of cash remains constant at $1 over time)</span>
</span></span><span class="line"><span class="cl"><span class="n">perm_port</span><span class="p">[</span><span class="s1">&#39;Cash_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Remove any rows with missing values (NaN) to ensure clean data for further analysis</span>
</span></span><span class="line"><span class="cl"><span class="n">perm_port</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the finalized portfolio DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">perm_port</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="check-for-missing-values">Check For Missing Values
</h3><p>We can check for any missing (NaN) values in each column:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Check for any missing values in each column</span>
</span></span><span class="line"><span class="cl"><span class="n">perm_port</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="dataframe-info">DataFrame Info
</h3><p>Now, running:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_info</span><span class="p">(</span><span class="n">perm_port</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Gives us the following:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">The columns, shape, and data types are:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
</span></span><span class="line"><span class="cl">DatetimeIndex: 8479 entries, 1990-01-02 to 2023-12-29
</span></span><span class="line"><span class="cl">Data columns (total 4 columns):
</span></span><span class="line"><span class="cl"> #   Column        Non-Null Count  Dtype  
</span></span><span class="line"><span class="cl">---  ------        --------------  -----  
</span></span><span class="line"><span class="cl"> 0   Stocks_Close  8479 non-null   float64
</span></span><span class="line"><span class="cl"> 1   Bonds_Close   8479 non-null   float64
</span></span><span class="line"><span class="cl"> 2   Gold_Close    8479 non-null   float64
</span></span><span class="line"><span class="cl"> 3   Cash_Close    8479 non-null   int64  
</span></span><span class="line"><span class="cl">dtypes: float64(3), int64(1)
</span></span><span class="line"><span class="cl">memory usage: 331.2 KB
</span></span></code></pre></td></tr></table>
</div>
</div><p>The first 5 rows are:</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">Date</th>
          <th style="text-align: right">Stocks_Close</th>
          <th style="text-align: right">Bonds_Close</th>
          <th style="text-align: right">Gold_Close</th>
          <th style="text-align: right">Cash_Close</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">1990-01-02 00:00:00</td>
          <td style="text-align: right">386.16</td>
          <td style="text-align: right">99.97</td>
          <td style="text-align: right">399.00</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-03 00:00:00</td>
          <td style="text-align: right">385.17</td>
          <td style="text-align: right">99.73</td>
          <td style="text-align: right">395.00</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-04 00:00:00</td>
          <td style="text-align: right">382.02</td>
          <td style="text-align: right">99.81</td>
          <td style="text-align: right">396.50</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-05 00:00:00</td>
          <td style="text-align: right">378.30</td>
          <td style="text-align: right">99.77</td>
          <td style="text-align: right">405.00</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-08 00:00:00</td>
          <td style="text-align: right">380.04</td>
          <td style="text-align: right">99.68</td>
          <td style="text-align: right">404.60</td>
          <td style="text-align: right">1.00</td>
      </tr>
  </tbody>
</table></div>
<p>The last 5 rows are:</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">Date</th>
          <th style="text-align: right">Stocks_Close</th>
          <th style="text-align: right">Bonds_Close</th>
          <th style="text-align: right">Gold_Close</th>
          <th style="text-align: right">Cash_Close</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">2023-12-22 00:00:00</td>
          <td style="text-align: right">10292.37</td>
          <td style="text-align: right">604.17</td>
          <td style="text-align: right">2053.08</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">2023-12-26 00:00:00</td>
          <td style="text-align: right">10335.98</td>
          <td style="text-align: right">604.55</td>
          <td style="text-align: right">2067.81</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">2023-12-27 00:00:00</td>
          <td style="text-align: right">10351.60</td>
          <td style="text-align: right">609.36</td>
          <td style="text-align: right">2077.49</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">2023-12-28 00:00:00</td>
          <td style="text-align: right">10356.59</td>
          <td style="text-align: right">606.83</td>
          <td style="text-align: right">2065.61</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">2023-12-29 00:00:00</td>
          <td style="text-align: right">10327.83</td>
          <td style="text-align: right">606.18</td>
          <td style="text-align: right">2062.98</td>
          <td style="text-align: right">1.00</td>
      </tr>
  </tbody>
</table></div>
<p>We can see that we have close data for all 4 asset classes from the beginning of 1990 to the end of 2023.</p>
<h2 id="execute-strategy">Execute Strategy
</h2><p>Using an annual rebalance date of January 1, we&rsquo;ll now execute the strategy with the following code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># List of funds to be used</span>
</span></span><span class="line"><span class="cl"><span class="n">fund_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Stocks&#39;</span><span class="p">,</span> <span class="s1">&#39;Bonds&#39;</span><span class="p">,</span> <span class="s1">&#39;Gold&#39;</span><span class="p">,</span> <span class="s1">&#39;Cash&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Starting cash contribution</span>
</span></span><span class="line"><span class="cl"><span class="n">starting_cash</span> <span class="o">=</span> <span class="mi">10000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Monthly cash contribution</span>
</span></span><span class="line"><span class="cl"><span class="n">cash_contrib</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strat</span> <span class="o">=</span> <span class="n">strategy_harry_brown_perm_port</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_list</span><span class="o">=</span><span class="n">fund_list</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">starting_cash</span><span class="o">=</span><span class="n">starting_cash</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">cash_contrib</span><span class="o">=</span><span class="n">cash_contrib</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">close_prices_df</span><span class="o">=</span><span class="n">perm_port</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_day</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_per_high</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_per_low</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strat</span> <span class="o">=</span> <span class="n">strat</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Running:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_info</span><span class="p">(</span><span class="n">strat</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Gives us:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">The columns, shape, and data types are:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
</span></span><span class="line"><span class="cl">DatetimeIndex: 8479 entries, 1990-01-02 to 2023-12-29
</span></span><span class="line"><span class="cl">Data columns (total 34 columns):
</span></span><span class="line"><span class="cl"> #   Column                Non-Null Count  Dtype  
</span></span><span class="line"><span class="cl">---  ------                --------------  -----  
</span></span><span class="line"><span class="cl"> 0   Stocks_Close          8479 non-null   float64
</span></span><span class="line"><span class="cl"> 1   Bonds_Close           8479 non-null   float64
</span></span><span class="line"><span class="cl"> 2   Gold_Close            8479 non-null   float64
</span></span><span class="line"><span class="cl"> 3   Cash_Close            8479 non-null   int64  
</span></span><span class="line"><span class="cl"> 4   Stocks_BA_Shares      8479 non-null   float64
</span></span><span class="line"><span class="cl"> 5   Stocks_BA_$_Invested  8479 non-null   float64
</span></span><span class="line"><span class="cl"> 6   Stocks_BA_Port_%      8479 non-null   float64
</span></span><span class="line"><span class="cl"> 7   Bonds_BA_Shares       8479 non-null   float64
</span></span><span class="line"><span class="cl"> 8   Bonds_BA_$_Invested   8479 non-null   float64
</span></span><span class="line"><span class="cl"> 9   Bonds_BA_Port_%       8479 non-null   float64
</span></span><span class="line"><span class="cl"> 10  Gold_BA_Shares        8479 non-null   float64
</span></span><span class="line"><span class="cl"> 11  Gold_BA_$_Invested    8479 non-null   float64
</span></span><span class="line"><span class="cl"> 12  Gold_BA_Port_%        8479 non-null   float64
</span></span><span class="line"><span class="cl"> 13  Cash_BA_Shares        8479 non-null   float64
</span></span><span class="line"><span class="cl"> 14  Cash_BA_$_Invested    8479 non-null   float64
</span></span><span class="line"><span class="cl"> 15  Cash_BA_Port_%        8479 non-null   float64
</span></span><span class="line"><span class="cl"> 16  Total_BA_$_Invested   8479 non-null   float64
</span></span><span class="line"><span class="cl"> 17  Contribution          8479 non-null   int64  
</span></span><span class="line"><span class="cl"> 18  Rebalance             8479 non-null   object 
</span></span><span class="line"><span class="cl"> 19  Stocks_AA_Shares      8479 non-null   float64
</span></span><span class="line"><span class="cl"> 20  Stocks_AA_$_Invested  8479 non-null   float64
</span></span><span class="line"><span class="cl"> 21  Stocks_AA_Port_%      8479 non-null   float64
</span></span><span class="line"><span class="cl"> 22  Bonds_AA_Shares       8479 non-null   float64
</span></span><span class="line"><span class="cl"> 23  Bonds_AA_$_Invested   8479 non-null   float64
</span></span><span class="line"><span class="cl"> 24  Bonds_AA_Port_%       8479 non-null   float64
</span></span><span class="line"><span class="cl"> 25  Gold_AA_Shares        8479 non-null   float64
</span></span><span class="line"><span class="cl"> 26  Gold_AA_$_Invested    8479 non-null   float64
</span></span><span class="line"><span class="cl"> 27  Gold_AA_Port_%        8479 non-null   float64
</span></span><span class="line"><span class="cl"> 28  Cash_AA_Shares        8479 non-null   float64
</span></span><span class="line"><span class="cl"> 29  Cash_AA_$_Invested    8479 non-null   float64
</span></span><span class="line"><span class="cl"> 30  Cash_AA_Port_%        8479 non-null   float64
</span></span><span class="line"><span class="cl"> 31  Total_AA_$_Invested   8479 non-null   float64
</span></span><span class="line"><span class="cl"> 32  Return                8478 non-null   float64
</span></span><span class="line"><span class="cl"> 33  Cumulative_Return     8478 non-null   float64
</span></span><span class="line"><span class="cl">dtypes: float64(31), int64(2), object(1)
</span></span><span class="line"><span class="cl">memory usage: 2.3+ MB
</span></span></code></pre></td></tr></table>
</div>
</div><p>The first 5 rows are:</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">Date</th>
          <th style="text-align: right">Stocks_Close</th>
          <th style="text-align: right">Bonds_Close</th>
          <th style="text-align: right">Gold_Close</th>
          <th style="text-align: right">Cash_Close</th>
          <th style="text-align: right">Stocks_BA_Shares</th>
          <th style="text-align: right">Stocks_BA_$_Invested</th>
          <th style="text-align: right">Stocks_BA_Port_%</th>
          <th style="text-align: right">Bonds_BA_Shares</th>
          <th style="text-align: right">Bonds_BA_$_Invested</th>
          <th style="text-align: right">Bonds_BA_Port_%</th>
          <th style="text-align: right">Gold_BA_Shares</th>
          <th style="text-align: right">Gold_BA_$_Invested</th>
          <th style="text-align: right">Gold_BA_Port_%</th>
          <th style="text-align: right">Cash_BA_Shares</th>
          <th style="text-align: right">Cash_BA_$_Invested</th>
          <th style="text-align: right">Cash_BA_Port_%</th>
          <th style="text-align: right">Total_BA_$_Invested</th>
          <th style="text-align: right">Contribution</th>
          <th style="text-align: left">Rebalance</th>
          <th style="text-align: right">Stocks_AA_Shares</th>
          <th style="text-align: right">Stocks_AA_$_Invested</th>
          <th style="text-align: right">Stocks_AA_Port_%</th>
          <th style="text-align: right">Bonds_AA_Shares</th>
          <th style="text-align: right">Bonds_AA_$_Invested</th>
          <th style="text-align: right">Bonds_AA_Port_%</th>
          <th style="text-align: right">Gold_AA_Shares</th>
          <th style="text-align: right">Gold_AA_$_Invested</th>
          <th style="text-align: right">Gold_AA_Port_%</th>
          <th style="text-align: right">Cash_AA_Shares</th>
          <th style="text-align: right">Cash_AA_$_Invested</th>
          <th style="text-align: right">Cash_AA_Port_%</th>
          <th style="text-align: right">Total_AA_$_Invested</th>
          <th style="text-align: right">Return</th>
          <th style="text-align: right">Cumulative_Return</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">1990-01-02 00:00:00</td>
          <td style="text-align: right">386.16</td>
          <td style="text-align: right">99.97</td>
          <td style="text-align: right">399.00</td>
          <td style="text-align: right">1</td>
          <td style="text-align: right">6.47</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">25.01</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">6.27</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">10000.00</td>
          <td style="text-align: right">0</td>
          <td style="text-align: left">No</td>
          <td style="text-align: right">6.47</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">25.01</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">6.27</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">10000.00</td>
          <td style="text-align: right">nan</td>
          <td style="text-align: right">nan</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-03 00:00:00</td>
          <td style="text-align: right">385.17</td>
          <td style="text-align: right">99.73</td>
          <td style="text-align: right">395.00</td>
          <td style="text-align: right">1</td>
          <td style="text-align: right">6.47</td>
          <td style="text-align: right">2493.59</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">25.01</td>
          <td style="text-align: right">2494.02</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">6.27</td>
          <td style="text-align: right">2474.94</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">9962.55</td>
          <td style="text-align: right">0</td>
          <td style="text-align: left">No</td>
          <td style="text-align: right">6.47</td>
          <td style="text-align: right">2493.59</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">25.01</td>
          <td style="text-align: right">2494.02</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">6.27</td>
          <td style="text-align: right">2474.94</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">9962.55</td>
          <td style="text-align: right">-0.00</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-04 00:00:00</td>
          <td style="text-align: right">382.02</td>
          <td style="text-align: right">99.81</td>
          <td style="text-align: right">396.50</td>
          <td style="text-align: right">1</td>
          <td style="text-align: right">6.47</td>
          <td style="text-align: right">2473.20</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">25.01</td>
          <td style="text-align: right">2496.02</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">6.27</td>
          <td style="text-align: right">2484.34</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">9953.56</td>
          <td style="text-align: right">0</td>
          <td style="text-align: left">No</td>
          <td style="text-align: right">6.47</td>
          <td style="text-align: right">2473.20</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">25.01</td>
          <td style="text-align: right">2496.02</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">6.27</td>
          <td style="text-align: right">2484.34</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">9953.56</td>
          <td style="text-align: right">-0.00</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-05 00:00:00</td>
          <td style="text-align: right">378.30</td>
          <td style="text-align: right">99.77</td>
          <td style="text-align: right">405.00</td>
          <td style="text-align: right">1</td>
          <td style="text-align: right">6.47</td>
          <td style="text-align: right">2449.11</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">25.01</td>
          <td style="text-align: right">2494.92</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">6.27</td>
          <td style="text-align: right">2537.59</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">9981.63</td>
          <td style="text-align: right">0</td>
          <td style="text-align: left">No</td>
          <td style="text-align: right">6.47</td>
          <td style="text-align: right">2449.11</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">25.01</td>
          <td style="text-align: right">2494.92</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">6.27</td>
          <td style="text-align: right">2537.59</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">9981.63</td>
          <td style="text-align: right">0.00</td>
          <td style="text-align: right">1.00</td>
      </tr>
      <tr>
          <td style="text-align: left">1990-01-08 00:00:00</td>
          <td style="text-align: right">380.04</td>
          <td style="text-align: right">99.68</td>
          <td style="text-align: right">404.60</td>
          <td style="text-align: right">1</td>
          <td style="text-align: right">6.47</td>
          <td style="text-align: right">2460.38</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">25.01</td>
          <td style="text-align: right">2492.72</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">6.27</td>
          <td style="text-align: right">2535.09</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">9988.19</td>
          <td style="text-align: right">0</td>
          <td style="text-align: left">No</td>
          <td style="text-align: right">6.47</td>
          <td style="text-align: right">2460.38</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">25.01</td>
          <td style="text-align: right">2492.72</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">6.27</td>
          <td style="text-align: right">2535.09</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">2500.00</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">9988.19</td>
          <td style="text-align: right">0.00</td>
          <td style="text-align: right">1.00</td>
      </tr>
  </tbody>
</table></div>
<p>The last 5 rows are:</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">Date</th>
          <th style="text-align: right">Stocks_Close</th>
          <th style="text-align: right">Bonds_Close</th>
          <th style="text-align: right">Gold_Close</th>
          <th style="text-align: right">Cash_Close</th>
          <th style="text-align: right">Stocks_BA_Shares</th>
          <th style="text-align: right">Stocks_BA_$_Invested</th>
          <th style="text-align: right">Stocks_BA_Port_%</th>
          <th style="text-align: right">Bonds_BA_Shares</th>
          <th style="text-align: right">Bonds_BA_$_Invested</th>
          <th style="text-align: right">Bonds_BA_Port_%</th>
          <th style="text-align: right">Gold_BA_Shares</th>
          <th style="text-align: right">Gold_BA_$_Invested</th>
          <th style="text-align: right">Gold_BA_Port_%</th>
          <th style="text-align: right">Cash_BA_Shares</th>
          <th style="text-align: right">Cash_BA_$_Invested</th>
          <th style="text-align: right">Cash_BA_Port_%</th>
          <th style="text-align: right">Total_BA_$_Invested</th>
          <th style="text-align: right">Contribution</th>
          <th style="text-align: left">Rebalance</th>
          <th style="text-align: right">Stocks_AA_Shares</th>
          <th style="text-align: right">Stocks_AA_$_Invested</th>
          <th style="text-align: right">Stocks_AA_Port_%</th>
          <th style="text-align: right">Bonds_AA_Shares</th>
          <th style="text-align: right">Bonds_AA_$_Invested</th>
          <th style="text-align: right">Bonds_AA_Port_%</th>
          <th style="text-align: right">Gold_AA_Shares</th>
          <th style="text-align: right">Gold_AA_$_Invested</th>
          <th style="text-align: right">Gold_AA_Port_%</th>
          <th style="text-align: right">Cash_AA_Shares</th>
          <th style="text-align: right">Cash_AA_$_Invested</th>
          <th style="text-align: right">Cash_AA_Port_%</th>
          <th style="text-align: right">Total_AA_$_Invested</th>
          <th style="text-align: right">Return</th>
          <th style="text-align: right">Cumulative_Return</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">2023-12-22 00:00:00</td>
          <td style="text-align: right">10292.37</td>
          <td style="text-align: right">604.17</td>
          <td style="text-align: right">2053.08</td>
          <td style="text-align: right">1</td>
          <td style="text-align: right">1.81</td>
          <td style="text-align: right">18595.87</td>
          <td style="text-align: right">0.29</td>
          <td style="text-align: right">25.03</td>
          <td style="text-align: right">15124.46</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">8.00</td>
          <td style="text-align: right">16426.12</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">64863.62</td>
          <td style="text-align: right">0</td>
          <td style="text-align: left">No</td>
          <td style="text-align: right">1.81</td>
          <td style="text-align: right">18595.87</td>
          <td style="text-align: right">0.29</td>
          <td style="text-align: right">25.03</td>
          <td style="text-align: right">15124.46</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">8.00</td>
          <td style="text-align: right">16426.12</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">64863.62</td>
          <td style="text-align: right">0.00</td>
          <td style="text-align: right">6.49</td>
      </tr>
      <tr>
          <td style="text-align: left">2023-12-26 00:00:00</td>
          <td style="text-align: right">10335.98</td>
          <td style="text-align: right">604.55</td>
          <td style="text-align: right">2067.81</td>
          <td style="text-align: right">1</td>
          <td style="text-align: right">1.81</td>
          <td style="text-align: right">18674.66</td>
          <td style="text-align: right">0.29</td>
          <td style="text-align: right">25.03</td>
          <td style="text-align: right">15134.20</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">8.00</td>
          <td style="text-align: right">16543.97</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">65070.01</td>
          <td style="text-align: right">0</td>
          <td style="text-align: left">No</td>
          <td style="text-align: right">1.81</td>
          <td style="text-align: right">18674.66</td>
          <td style="text-align: right">0.29</td>
          <td style="text-align: right">25.03</td>
          <td style="text-align: right">15134.20</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">8.00</td>
          <td style="text-align: right">16543.97</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">65070.01</td>
          <td style="text-align: right">0.00</td>
          <td style="text-align: right">6.51</td>
      </tr>
      <tr>
          <td style="text-align: left">2023-12-27 00:00:00</td>
          <td style="text-align: right">10351.60</td>
          <td style="text-align: right">609.36</td>
          <td style="text-align: right">2077.49</td>
          <td style="text-align: right">1</td>
          <td style="text-align: right">1.81</td>
          <td style="text-align: right">18702.89</td>
          <td style="text-align: right">0.29</td>
          <td style="text-align: right">25.03</td>
          <td style="text-align: right">15254.36</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">8.00</td>
          <td style="text-align: right">16621.42</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">65295.84</td>
          <td style="text-align: right">0</td>
          <td style="text-align: left">No</td>
          <td style="text-align: right">1.81</td>
          <td style="text-align: right">18702.89</td>
          <td style="text-align: right">0.29</td>
          <td style="text-align: right">25.03</td>
          <td style="text-align: right">15254.36</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">8.00</td>
          <td style="text-align: right">16621.42</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">65295.84</td>
          <td style="text-align: right">0.00</td>
          <td style="text-align: right">6.53</td>
      </tr>
      <tr>
          <td style="text-align: left">2023-12-28 00:00:00</td>
          <td style="text-align: right">10356.59</td>
          <td style="text-align: right">606.83</td>
          <td style="text-align: right">2065.61</td>
          <td style="text-align: right">1</td>
          <td style="text-align: right">1.81</td>
          <td style="text-align: right">18711.90</td>
          <td style="text-align: right">0.29</td>
          <td style="text-align: right">25.03</td>
          <td style="text-align: right">15191.10</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">8.00</td>
          <td style="text-align: right">16526.37</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">65146.54</td>
          <td style="text-align: right">0</td>
          <td style="text-align: left">No</td>
          <td style="text-align: right">1.81</td>
          <td style="text-align: right">18711.90</td>
          <td style="text-align: right">0.29</td>
          <td style="text-align: right">25.03</td>
          <td style="text-align: right">15191.10</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">8.00</td>
          <td style="text-align: right">16526.37</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">65146.54</td>
          <td style="text-align: right">-0.00</td>
          <td style="text-align: right">6.51</td>
      </tr>
      <tr>
          <td style="text-align: left">2023-12-29 00:00:00</td>
          <td style="text-align: right">10327.83</td>
          <td style="text-align: right">606.18</td>
          <td style="text-align: right">2062.98</td>
          <td style="text-align: right">1</td>
          <td style="text-align: right">1.81</td>
          <td style="text-align: right">18659.94</td>
          <td style="text-align: right">0.29</td>
          <td style="text-align: right">25.03</td>
          <td style="text-align: right">15175.01</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">8.00</td>
          <td style="text-align: right">16505.33</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">65057.44</td>
          <td style="text-align: right">0</td>
          <td style="text-align: left">No</td>
          <td style="text-align: right">1.81</td>
          <td style="text-align: right">18659.94</td>
          <td style="text-align: right">0.29</td>
          <td style="text-align: right">25.03</td>
          <td style="text-align: right">15175.01</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">8.00</td>
          <td style="text-align: right">16505.33</td>
          <td style="text-align: right">0.25</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">14717.17</td>
          <td style="text-align: right">0.23</td>
          <td style="text-align: right">65057.44</td>
          <td style="text-align: right">-0.00</td>
          <td style="text-align: right">6.51</td>
      </tr>
  </tbody>
</table></div>
<h2 id="strategy-statistics">Strategy Statistics
</h2><p>Let&rsquo;s look at the summary statistics for the entire timeframe, as well as several different ranges:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">sum_stats</span> <span class="o">=</span> <span class="n">summary_stats</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_list</span><span class="o">=</span><span class="n">fund_list</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">=</span><span class="n">strat</span><span class="p">[[</span><span class="s1">&#39;Return&#39;</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">    <span class="n">period</span><span class="o">=</span><span class="s2">&#34;Daily&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strat_pre_1999</span> <span class="o">=</span> <span class="n">strat</span><span class="p">[</span><span class="n">strat</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="s1">&#39;2000-01-01&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">sum_stats_pre_1999</span> <span class="o">=</span> <span class="n">summary_stats</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_list</span><span class="o">=</span><span class="n">fund_list</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">=</span><span class="n">strat_pre_1999</span><span class="p">[[</span><span class="s1">&#39;Return&#39;</span><span class="p">]],</span> 
</span></span><span class="line"><span class="cl">    <span class="n">period</span><span class="o">=</span><span class="s2">&#34;Daily&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strat_post_1999</span> <span class="o">=</span> <span class="n">strat</span><span class="p">[</span><span class="n">strat</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s1">&#39;2000-01-01&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">sum_stats_post_1999</span> <span class="o">=</span> <span class="n">summary_stats</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_list</span><span class="o">=</span><span class="n">fund_list</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">=</span><span class="n">strat_post_1999</span><span class="p">[[</span><span class="s1">&#39;Return&#39;</span><span class="p">]],</span> 
</span></span><span class="line"><span class="cl">    <span class="n">period</span><span class="o">=</span><span class="s2">&#34;Daily&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strat_post_2009</span> <span class="o">=</span> <span class="n">strat</span><span class="p">[</span><span class="n">strat</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s1">&#39;2010-01-01&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">sum_stats_post_2009</span> <span class="o">=</span> <span class="n">summary_stats</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_list</span><span class="o">=</span><span class="n">fund_list</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">=</span><span class="n">strat_post_2009</span><span class="p">[[</span><span class="s1">&#39;Return&#39;</span><span class="p">]],</span> 
</span></span><span class="line"><span class="cl">    <span class="n">period</span><span class="o">=</span><span class="s2">&#34;Daily&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>And the concat them to make comparing them easier:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">all_sum_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sum_stats</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">all_sum_stats</span> <span class="o">=</span> <span class="n">all_sum_stats</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Return&#39;</span><span class="p">:</span> <span class="s1">&#39;1990 - 2023&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">all_sum_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">all_sum_stats</span><span class="p">,</span> <span class="n">sum_stats_pre_1999</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">all_sum_stats</span> <span class="o">=</span> <span class="n">all_sum_stats</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Return&#39;</span><span class="p">:</span> <span class="s1">&#39;Pre 1999&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">all_sum_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">all_sum_stats</span><span class="p">,</span> <span class="n">sum_stats_post_1999</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">all_sum_stats</span> <span class="o">=</span> <span class="n">all_sum_stats</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Return&#39;</span><span class="p">:</span> <span class="s1">&#39;Post 1999&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">all_sum_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">all_sum_stats</span><span class="p">,</span> <span class="n">sum_stats_post_2009</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">all_sum_stats</span> <span class="o">=</span> <span class="n">all_sum_stats</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Return&#39;</span><span class="p">:</span> <span class="s1">&#39;Post 2009&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">all_sum_stats</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Which gives us:</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left"></th>
          <th style="text-align: right">Annualized Mean</th>
          <th style="text-align: right">Annualized Volatility</th>
          <th style="text-align: right">Annualized Sharpe Ratio</th>
          <th style="text-align: right">CAGR</th>
          <th style="text-align: right">Daily Max Return</th>
          <th style="text-align: left">Daily Max Return (Date)</th>
          <th style="text-align: right">Daily Min Return</th>
          <th style="text-align: left">Daily Min Return (Date)</th>
          <th style="text-align: right">Max Drawdown</th>
          <th style="text-align: left">Peak</th>
          <th style="text-align: left">Bottom</th>
          <th style="text-align: left">Recovery Date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">1990 - 2023</td>
          <td style="text-align: right">0.057</td>
          <td style="text-align: right">0.060</td>
          <td style="text-align: right">0.957</td>
          <td style="text-align: right">0.057</td>
          <td style="text-align: right">0.029</td>
          <td style="text-align: left">2020-03-24 00:00:00</td>
          <td style="text-align: right">-0.030</td>
          <td style="text-align: left">2020-03-12 00:00:00</td>
          <td style="text-align: right">-0.154</td>
          <td style="text-align: left">2008-03-18 00:00:00</td>
          <td style="text-align: left">2008-11-12 00:00:00</td>
          <td style="text-align: left">2009-10-06 00:00:00</td>
      </tr>
      <tr>
          <td style="text-align: left">Pre 1999</td>
          <td style="text-align: right">0.060</td>
          <td style="text-align: right">0.050</td>
          <td style="text-align: right">1.207</td>
          <td style="text-align: right">0.061</td>
          <td style="text-align: right">0.022</td>
          <td style="text-align: left">1999-09-28 00:00:00</td>
          <td style="text-align: right">-0.018</td>
          <td style="text-align: left">1993-08-05 00:00:00</td>
          <td style="text-align: right">-0.062</td>
          <td style="text-align: left">1998-07-20 00:00:00</td>
          <td style="text-align: left">1998-08-31 00:00:00</td>
          <td style="text-align: left">1998-11-05 00:00:00</td>
      </tr>
      <tr>
          <td style="text-align: left">Post 1999</td>
          <td style="text-align: right">0.056</td>
          <td style="text-align: right">0.064</td>
          <td style="text-align: right">0.883</td>
          <td style="text-align: right">0.056</td>
          <td style="text-align: right">0.029</td>
          <td style="text-align: left">2020-03-24 00:00:00</td>
          <td style="text-align: right">-0.030</td>
          <td style="text-align: left">2020-03-12 00:00:00</td>
          <td style="text-align: right">-0.154</td>
          <td style="text-align: left">2008-03-18 00:00:00</td>
          <td style="text-align: left">2008-11-12 00:00:00</td>
          <td style="text-align: left">2009-10-06 00:00:00</td>
      </tr>
      <tr>
          <td style="text-align: left">Post 2009</td>
          <td style="text-align: right">0.056</td>
          <td style="text-align: right">0.060</td>
          <td style="text-align: right">0.927</td>
          <td style="text-align: right">0.056</td>
          <td style="text-align: right">0.029</td>
          <td style="text-align: left">2020-03-24 00:00:00</td>
          <td style="text-align: right">-0.030</td>
          <td style="text-align: left">2020-03-12 00:00:00</td>
          <td style="text-align: right">-0.127</td>
          <td style="text-align: left">2021-12-27 00:00:00</td>
          <td style="text-align: left">2022-10-20 00:00:00</td>
          <td style="text-align: left">2023-12-01 00:00:00</td>
      </tr>
  </tbody>
</table></div>
<!-- Here we have a mean annualized return of 8.3%, volatility of 7.2%, a CAGR of 8.4% and a Sharpe ratio of 1.15. And this with a max drawdown of just over 15%. Not bad, Mr. Browne!

Since the book was published in 1999, let's look specifically at the summary stats for below and after 1999.

The mean annualized return is approximately 0.7% lower for the pre 1999 vs post 1999 data, as is the CAGR. The volatility is higher for the post 1999 data which leads to a difference in the Sharpe ratio. -->
<h2 id="annual-returns">Annual Returns
</h2><p>Here&rsquo;s the annual returns:</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: right">Year</th>
          <th style="text-align: right">Return</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: right">1991</td>
          <td style="text-align: right">0.102</td>
      </tr>
      <tr>
          <td style="text-align: right">1992</td>
          <td style="text-align: right">0.030</td>
      </tr>
      <tr>
          <td style="text-align: right">1993</td>
          <td style="text-align: right">0.099</td>
      </tr>
      <tr>
          <td style="text-align: right">1994</td>
          <td style="text-align: right">-0.017</td>
      </tr>
      <tr>
          <td style="text-align: right">1995</td>
          <td style="text-align: right">0.153</td>
      </tr>
      <tr>
          <td style="text-align: right">1996</td>
          <td style="text-align: right">0.049</td>
      </tr>
      <tr>
          <td style="text-align: right">1997</td>
          <td style="text-align: right">0.056</td>
      </tr>
      <tr>
          <td style="text-align: right">1998</td>
          <td style="text-align: right">0.102</td>
      </tr>
      <tr>
          <td style="text-align: right">1999</td>
          <td style="text-align: right">0.039</td>
      </tr>
      <tr>
          <td style="text-align: right">2000</td>
          <td style="text-align: right">0.000</td>
      </tr>
      <tr>
          <td style="text-align: right">2001</td>
          <td style="text-align: right">-0.005</td>
      </tr>
      <tr>
          <td style="text-align: right">2002</td>
          <td style="text-align: right">0.043</td>
      </tr>
      <tr>
          <td style="text-align: right">2003</td>
          <td style="text-align: right">0.121</td>
      </tr>
      <tr>
          <td style="text-align: right">2004</td>
          <td style="text-align: right">0.051</td>
      </tr>
      <tr>
          <td style="text-align: right">2005</td>
          <td style="text-align: right">0.064</td>
      </tr>
      <tr>
          <td style="text-align: right">2006</td>
          <td style="text-align: right">0.104</td>
      </tr>
      <tr>
          <td style="text-align: right">2007</td>
          <td style="text-align: right">0.117</td>
      </tr>
      <tr>
          <td style="text-align: right">2008</td>
          <td style="text-align: right">-0.033</td>
      </tr>
      <tr>
          <td style="text-align: right">2009</td>
          <td style="text-align: right">0.107</td>
      </tr>
      <tr>
          <td style="text-align: right">2010</td>
          <td style="text-align: right">0.137</td>
      </tr>
      <tr>
          <td style="text-align: right">2011</td>
          <td style="text-align: right">0.070</td>
      </tr>
      <tr>
          <td style="text-align: right">2012</td>
          <td style="text-align: right">0.068</td>
      </tr>
      <tr>
          <td style="text-align: right">2013</td>
          <td style="text-align: right">-0.006</td>
      </tr>
      <tr>
          <td style="text-align: right">2014</td>
          <td style="text-align: right">0.052</td>
      </tr>
      <tr>
          <td style="text-align: right">2015</td>
          <td style="text-align: right">-0.018</td>
      </tr>
      <tr>
          <td style="text-align: right">2016</td>
          <td style="text-align: right">0.052</td>
      </tr>
      <tr>
          <td style="text-align: right">2017</td>
          <td style="text-align: right">0.095</td>
      </tr>
      <tr>
          <td style="text-align: right">2018</td>
          <td style="text-align: right">-0.012</td>
      </tr>
      <tr>
          <td style="text-align: right">2019</td>
          <td style="text-align: right">0.145</td>
      </tr>
      <tr>
          <td style="text-align: right">2020</td>
          <td style="text-align: right">0.134</td>
      </tr>
      <tr>
          <td style="text-align: right">2021</td>
          <td style="text-align: right">0.057</td>
      </tr>
      <tr>
          <td style="text-align: right">2022</td>
          <td style="text-align: right">-0.082</td>
      </tr>
      <tr>
          <td style="text-align: right">2023</td>
          <td style="text-align: right">0.109</td>
      </tr>
  </tbody>
</table></div>
<p>Since the strategy, summary statistics, and annual returns are all exported as excel files, they can be found at the following locations:</p>
<p><a class="link" href="Stocks_Bonds_Gold_Cash_Strategy.xlsx" >Stocks_Bonds_Gold_Cash_Strategy.xlsx</a></br>
<a class="link" href="Stocks_Bonds_Gold_Cash_Summary_Stats.xlsx" >Stocks_Bonds_Gold_Cash_Summary_Stats.xlsx</a></br>
<a class="link" href="Stocks_Bonds_Gold_Cash_Annual_Returns.xlsx" >Stocks_Bonds_Gold_Cash_Annual_Returns.xlsx</a></br></p>
<p>Next we will look at some plots to help visualize the data.</p>
<h2 id="generate-plots">Generate Plots
</h2><p>Here are the various functions needed for the plots:</p>
<h3 id="plot-cumulative-return">Plot Cumulative Return
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">plot_cumulative_return</span><span class="p">(</span><span class="n">strat_df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Generate plot</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;#F5F5F5&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Plotting data</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Cumulative_Return&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Strategy Cumulative Return&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set X axis</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># x_tick_spacing = 5  # Specify the interval for x-axis ticks</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.gca().xaxis.set_major_locator(MultipleLocator(x_tick_spacing))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.xlim(, )</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set Y axis</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_tick_spacing</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Specify the interval for y-axis ticks</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">y_tick_spacing</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Return&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set title, etc.</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cumulative Return&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set the grid &amp; legend</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save the figure</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;03_Cumulative_Return.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Display the plot</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="plot-portfolio-values">Plot Portfolio Values
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">plot_values</span><span class="p">(</span><span class="n">strat_df</span><span class="p">):</span>   
</span></span><span class="line"><span class="cl">    <span class="c1"># Generate plot   </span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;#F5F5F5&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Plotting data</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Total_AA_$_Invested&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total Portfolio Value&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Stocks_AA_$_Invested&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stocks Position Value&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Bonds_AA_$_Invested&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bond Position Value&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Gold_AA_$_Invested&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gold Position Value&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Cash_AA_$_Invested&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cash Position Value&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set X axis</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># x_tick_spacing = 5  # Specify the interval for x-axis ticks</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.gca().xaxis.set_major_locator(MultipleLocator(x_tick_spacing))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.xlim(, )</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set Y axis</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_tick_spacing</span> <span class="o">=</span> <span class="mi">5000</span>  <span class="c1"># Specify the interval for y-axis ticks</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">y_tick_spacing</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mtick</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="c1"># Adding commas to y-axis labels</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Value ($)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">75000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set title, etc.</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Total Values For Stocks, Bonds, Gold, and Cash Positions and Portfolio&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set the grid &amp; legend</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save the figure</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;04_Portfolio_Values.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Display the plot</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="plot-portfolio-drawdown">Plot Portfolio Drawdown
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">plot_drawdown</span><span class="p">(</span><span class="n">strat_df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">rolling_max</span> <span class="o">=</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Total_AA_$_Invested&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cummax</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">drawdown</span> <span class="o">=</span> <span class="p">(</span><span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Total_AA_$_Invested&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">rolling_max</span><span class="p">)</span> <span class="o">/</span> <span class="n">rolling_max</span> <span class="o">*</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Generate plot   </span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;#F5F5F5&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Plotting data</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">drawdown</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Drawdown&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set X axis</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># x_tick_spacing = 5  # Specify the interval for x-axis ticks</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.gca().xaxis.set_major_locator(MultipleLocator(x_tick_spacing))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.xlim(, )</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set Y axis</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_tick_spacing</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Specify the interval for y-axis ticks</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">y_tick_spacing</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.gca().yaxis.set_major_formatter(mtick.FuncFormatter(lambda x, pos: &#39;{:,.0f}&#39;.format(x))) # Adding commas to y-axis labels</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mtick</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="c1"># Adding 0 decimal places to y-axis labels</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Drawdown (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set title, etc.</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Portfolio Drawdown&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set the grid &amp; legend</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save the figure</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;05_Portfolio_Drawdown.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Display the plot</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="plot-portfolio-asset-weights">Plot Portfolio Asset Weights
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">plot_asset_weights</span><span class="p">(</span><span class="n">strat_df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Generate plot   </span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;#F5F5F5&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Plotting data</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Stocks_AA_Port_%&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stocks Portfolio Weight&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Bonds_AA_Port_%&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bonds Portfolio Weight&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Gold_AA_Port_%&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gold Portfolio Weight&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">strat_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">strat_df</span><span class="p">[</span><span class="s1">&#39;Cash_AA_Port_%&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cash Portfolio Weight&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set X axis</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># x_tick_spacing = 5  # Specify the interval for x-axis ticks</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.gca().xaxis.set_major_locator(MultipleLocator(x_tick_spacing))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.xlim(, )</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set Y axis</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_tick_spacing</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Specify the interval for y-axis ticks</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">y_tick_spacing</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.gca().yaxis.set_major_formatter(mtick.FuncFormatter(lambda x, pos: &#39;{:,.0f}&#39;.format(x))) # Adding commas to y-axis labels</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Asset Weight (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">36</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set title, etc.</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Portfolio Asset Weights For Stocks, Bonds, Gold, and Cash Positions&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set the grid &amp; legend</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save the figure</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;07_Portfolio_Weights.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Display the plot</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">plot_cumulative_return</span><span class="p">(</span><span class="n">strat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plot_values</span><span class="p">(</span><span class="n">strat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plot_drawdown</span><span class="p">(</span><span class="n">strat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plot_asset_weights</span><span class="p">(</span><span class="n">strat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create dataframe for the annual returns</span>
</span></span><span class="line"><span class="cl"><span class="n">strat_annual_returns</span> <span class="o">=</span> <span class="n">strat</span><span class="p">[</span><span class="s1">&#39;Cumulative_Return&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">strat_annual_returns_df</span> <span class="o">=</span> <span class="n">strat_annual_returns</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">strat_annual_returns_df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strat_annual_returns_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span>  <span class="c1"># Add a &#39;Year&#39; column with just the year</span>
</span></span><span class="line"><span class="cl"><span class="n">strat_annual_returns_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Reset the index to remove the datetime index</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Now the DataFrame will have &#39;Year&#39; and &#39;Cumulative_Return&#39; columns</span>
</span></span><span class="line"><span class="cl"><span class="n">strat_annual_returns_df</span> <span class="o">=</span> <span class="n">strat_annual_returns_df</span><span class="p">[[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Cumulative_Return&#39;</span><span class="p">]]</span>  <span class="c1"># Keep only &#39;Year&#39; and &#39;Cumulative_Return&#39; columns</span>
</span></span><span class="line"><span class="cl"><span class="n">strat_annual_returns_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Cumulative_Return&#39;</span><span class="p">:</span><span class="s1">&#39;Return&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">strat_annual_returns_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">strat_annual_returns_df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plan_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fund_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">file</span> <span class="o">=</span> <span class="n">plan_name</span> <span class="o">+</span> <span class="s2">&#34;_Annual_Returns.xlsx&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">location</span> <span class="o">=</span> <span class="n">file</span>
</span></span><span class="line"><span class="cl"><span class="n">strat_annual_returns_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plot_annual_returns</span><span class="p">(</span><span class="n">strat_annual_returns_df</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here are several relevant plots:</p>
<ol>
<li>Cumulative Return</li>
</ol>
<p><img src="/2024/11/04/harry-browne-permanent-portfolio/06_Cumulative_Return.png"
	width="2966"
	height="1461"
	
	loading="lazy"
	
		alt="Cumulative Return"
	
	
		class="gallery-image" 
		data-flex-grow="203"
		data-flex-basis="487px"
	
></p>
<ol start="2">
<li>Portfolio Values (Total, Stocks, Bonds, Gold, and Cash)</li>
</ol>
<p><img src="/2024/11/04/harry-browne-permanent-portfolio/07_Portfolio_Values.png"
	width="2966"
	height="1461"
	
	loading="lazy"
	
		alt="Portfolio Values"
	
	
		class="gallery-image" 
		data-flex-grow="203"
		data-flex-basis="487px"
	
></p>
<p>Here we can see the annual rebalancing taking effect with the values of the different asset classes. This can also be seen more clearly below.</p>
<ol start="3">
<li>Portfolio Drawdown</li>
</ol>
<p><img src="/2024/11/04/harry-browne-permanent-portfolio/08_Portfolio_Drawdown.png"
	width="2967"
	height="1461"
	
	loading="lazy"
	
		alt="Portfolio Drawdown"
	
	
		class="gallery-image" 
		data-flex-grow="203"
		data-flex-basis="487px"
	
></p>
<p>From this plot, we can see that the maximum drawdown came during the GFC; the drawdown during COVID was (interestingly) less than 10%.</p>
<ol start="4">
<li>Portfolio Asset Weights</li>
</ol>
<p><img src="/2024/11/04/harry-browne-permanent-portfolio/09_Portfolio_Weights.png"
	width="2966"
	height="1461"
	
	loading="lazy"
	
		alt="Portfolio Weights"
	
	
		class="gallery-image" 
		data-flex-grow="203"
		data-flex-basis="487px"
	
></p>
<p>The annual rebalancing appears to work effectively by selling assets that have increased in value and buying assets that have decreased in value over the previous year. Also note that there is only one instance when the weight of an asset fell to 15%. This occured for stocks during the GFC.</p>
<ol start="5">
<li>Portfolio Annual Returns</li>
</ol>
<p><img src="/2024/11/04/harry-browne-permanent-portfolio/10_Portfolio_Annual_Returns.png"
	width="2966"
	height="1461"
	
	loading="lazy"
	
		alt="Portfolio Annual Returns"
	
	
		class="gallery-image" 
		data-flex-grow="203"
		data-flex-basis="487px"
	
></p>
<p>It&rsquo;s interesting to see that there really aren&rsquo;t any significant up or down years. Instead, it&rsquo;s a steady climb without much volatility.</p>
<h2 id="summary">Summary
</h2><p>Overall, this is an interesting case study and Browne&rsquo;s idea behind the Permanent Portfolio is certainly compelling. There might be more investigation to be done with respect to the following:</p>
<ul>
<li>Investigate the extent to which the rebalancing date effects the portfolio performance</li>
<li>Vary the weights of the asset classes to see if there is a meanful change in the results</li>
<li>Experiment with leverage (i.e., simulating 1.2x leverage with a portfolio with weights of 30, 30, 30, 10 for stocks, bonds, gold, cash respectively.)</li>
<li>Use ETFs instead of Bloomberg index data, and verify the results are similar. ETF data is much more available than the Bloomberg index.</li>
</ul>
<h2 id="references">References
</h2><p>Fail-Safe Investing: Lifelong Financial Security in 30 Minutes, by Harry Browne</p>
<h2 id="code">Code
</h2><p>The jupyter notebook with the functions and all other code is available <a class="link" href="harry-browne-permanent-portfolio.ipynb" >here</a>.</br>
The html export of the jupyter notebook is available <a class="link" href="harry-browne-permanent-portfolio.html" >here</a>.</br>
The pdf export of the jupyter notebook is available <a class="link" href="harry-browne-permanent-portfolio.pdf" >here</a>.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/python/">Python</a>
        
            <a href="/tags/bloomberg/">Bloomberg</a>
        
            <a href="/tags/pandas/">Pandas</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            Last updated on May 6, 2025
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/2023/11/15/cleaning-bloomberg-excel-export/">
        
        
            <div class="article-image">
                <img src="/2023/11/15/cleaning-bloomberg-excel-export/cover.fbb99754d0fad3b1522686e2cd554489.jpg" 
                        width="1792" 
                        height="1024" 
                        loading="lazy"
                        alt="Featured image of post Cleaning A Bloomberg Data Excel Export"
                        data-key="cleaning-bloomberg-excel-export" 
                        data-hash="md5-&#43;7mXVND607FSJobizVVEiQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Cleaning A Bloomberg Data Excel Export</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/2025/03/01/investigating-a-vix-trading-signal/">
        
        
            <div class="article-image">
                <img src="/2025/03/01/investigating-a-vix-trading-signal/cover.5b82347f56b893f24c9470e806633142.jpg" 
                        width="1792" 
                        height="1024" 
                        loading="lazy"
                        alt="Featured image of post Investigating A VIX Trading Signal"
                        data-key="investigating-a-vix-trading-signal" 
                        data-hash="md5-W4I0f1a4k/JMlHDoBmMxQg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Investigating A VIX Trading Signal</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/2023/12/24/nasdaq-data-link-tables-api-data-retrieval/">
        
        
            <div class="article-image">
                <img src="/2023/12/24/nasdaq-data-link-tables-api-data-retrieval/cover.faace7bae0694be011b4df97baf5f416.jpg" 
                        width="1792" 
                        height="1024" 
                        loading="lazy"
                        alt="Featured image of post Nasdaq Data Link Tables API Data Retrieval"
                        data-key="nasdaq-data-link-tables-api-data-retrieval" 
                        data-hash="md5-&#43;qznuuBpS&#43;ARtN&#43;XuvX0Fg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Nasdaq Data Link Tables API Data Retrieval</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="jaredszajkowski/jaredszajkowski.github.io"
    data-repo-id="R_kgDOKZLn5w"
    data-category="Announcements"
    data-category-id="DIC_kwDOKZLn584CaJwO"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    data-loading=""
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2025 Jared Szajkowski
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
